<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<flow xmlns="http://www.springframework.org/schema/webflow" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xsi:schemaLocation="http://www.springframework.org/schema/webflow http://www.springframework.org/schema/webflow/spring-webflow-2.0.xsd">

    <var class="com.chariot.games.quizzo.web.form.TeamSetupForm" name="teamSetupForm"/>

    <!-- TODO: guard state that polls until teams are able to be registered. -->
    <view-state id="register-team" view="playQuizzo/register-team"
                model="flowScope.teamSetupForm">
        <transition on="continue" to="register-team-members" bind="true" validate="true"/>
    </view-state>

    <view-state id="register-team-members" view="playQuizzo/register-team-members"
                model="flowScope.teamSetupForm">

        <transition on="continue" to="ready-to-play" bind="true" validate="true">
            <evaluate expression="quizzoFlowManager.saveTeamData(flowRequestContext)"/>
        </transition>
        <transition on="add-team-member"/>
        <transition on="remove-team-member"/>
        <transition on="back" to="register-team"/>
    </view-state>

    <action-state id="ready-to-play">
        <evaluate expression="quizzoFlowManager.pollReady(flowRequestContext)"/>
        <transition on="yes" to="play-round"/>
        <transition on="poll" to="poll"/>
    </action-state>

    <view-state id="poll" view="playQuizzo/poll">
        <transition on="poll" to="ready-to-play" />
    </view-state>

    <view-state id="play-round" view="playQuizzo/play-round">
        <on-entry>
            <evaluate expression="quizzoFlowManager.setupQuestionAndChoices(flowRequestContext)" />
        </on-entry>
        <!--<on-render>-->
            <!--<evaluate expression="quizzoFlowManager.loadTeamStats(flowRequestContext)" />-->
        <!--</on-render>-->
        <transition on="send-answer">
            <evaluate expression="quizzoFlowManager.acceptAnswer(flowRequestContext)"/>
            <render fragments="answers" />
        </transition>
        <transition on="finalize-answers" to="ready-to-play">
            <evaluate expression="quizzoFlowManager.finalizeAnswers(flowRequestContext)" />
        </transition>
        <transition on="finish" to="game-over" />
    </view-state>

    <end-state id="game-over" view="playQuizzo/game-over"/>

</flow>
